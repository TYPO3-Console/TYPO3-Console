name: Consistency

on: [ push, pull_request ]

jobs:
    Unit:
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout
                uses: actions/checkout@v2

            -   name: Set up PHP Version ${{ matrix.php }}
                uses: shivammathur/setup-php@v2
                with:
                    php-version: 7.4
                    tools: composer:v2
                    coverage: none

            -   name: Environment Check
                run: |
                    php --version
                    composer --version

            -   name: Consistency Checks
                if: startsWith(github.ref, 'refs/tags/')
                run: |
                  composer set-version $(echo ${GITHUB_REF#refs/tags/} | sed s/^v//g)
                  test -z "$(git diff --shortstat 2> /dev/null | tail -n1)";
                  composer extension-verify-composer-json
                  composer extension-release
